# ğŸŸ—ï¸ Architecture Diagram - Worktree-Forms

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         END USER                                â”‚
â”‚                      (Browser/Mobile)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NGINX/LOAD BALANCER                        â”‚
â”‚                  (SSL Termination, Routing)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
        HTTP â”‚                                  â”‚ HTTP
             â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FRONTEND      â”‚              â”‚     BACKEND      â”‚
    â”‚   Next.js 14    â”‚              â”‚   Express.js     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Landing Page  â”‚              â”‚ â€¢ REST API       â”‚
    â”‚ â€¢ Auth Pages    â”‚              â”‚ â€¢ JWT Validation â”‚
    â”‚ â€¢ Dashboard     â”‚              â”‚ â€¢ RBAC Checks    â”‚
    â”‚ â€¢ Admin Panel   â”‚              â”‚ â€¢ Form Routes    â”‚
    â”‚ â€¢ Form Builder  â”‚              â”‚ â€¢ User Routes    â”‚
    â”‚ â€¢ UI Components â”‚              â”‚ â€¢ Admin Routes   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                â”‚
             â”‚ API Calls (JSON)               â”‚
             â”‚ http://backend:5000/api        â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                           â”‚
            â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DATABASE       â”‚      â”‚  REDIS CACHE    â”‚
    â”‚   PostgreSQL 15  â”‚      â”‚  Cache Layer    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Users          â”‚      â”‚ â€¢ Sessions      â”‚
    â”‚ â€¢ Roles          â”‚      â”‚ â€¢ Tokens        â”‚
    â”‚ â€¢ Permissions    â”‚      â”‚ â€¢ Rate Limits   â”‚
    â”‚ â€¢ Forms          â”‚      â”‚ â€¢ Form Cache    â”‚
    â”‚ â€¢ Submissions    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ Audit Logs     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Frontend Architecture

```
Frontend (Next.js 14)
â”œâ”€â”€ App Router
â”‚   â”œâ”€â”€ / (Landing)
â”‚   â”œâ”€â”€ /login (Auth)
â”‚   â”œâ”€â”€ /dashboard (Protected)
â”‚   â””â”€â”€ /admin (Protected + Role: Admin)
â”œâ”€â”€ Components
â”‚   â”œâ”€â”€ UI Components (Button, Card, etc.)
â”‚   â”œâ”€â”€ Form Components
â”‚   â””â”€â”€ Admin Components
â”œâ”€â”€ Lib
â”‚   â”œâ”€â”€ API Client (Axios)
â”‚   â”œâ”€â”€ Auth Utilities
â”‚   â””â”€â”€ Hooks
â”œâ”€â”€ Styles
â”‚   â”œâ”€â”€ Tailwind CSS
â”‚   â””â”€â”€ Ameritech Colors
â””â”€â”€ Public
    â””â”€â”€ Static Assets
```

## Backend Architecture

```
Backend (Express.js)
â”œâ”€â”€ HTTP Server (Port 5000)
â”‚   â”œâ”€â”€ CORS Middleware
â”‚   â”œâ”€â”€ Request Logging
â”‚   â”œâ”€â”€ JSON Parser
â”‚   â””â”€â”€ Error Handler
â”œâ”€â”€ Routes
â”‚   â”œâ”€â”€ GET /api/health
â”‚   â”œâ”€â”€ POST /api/auth/*
â”‚   â”œâ”€â”€ GET /api/users
â”‚   â”œâ”€â”€ POST/GET /api/forms
â”‚   â””â”€â”€ GET /api/admin/*
â”œâ”€â”€ Middleware
â”‚   â”œâ”€â”€ Auth (JWT Validation)
â”‚   â”œâ”€â”€ RBAC (Role Check)
â”‚   â”œâ”€â”€ Validation (Zod)
â”‚   â””â”€â”€ Audit (Logging)
â”œâ”€â”€ Services
â”‚   â”œâ”€â”€ AuthService
â”‚   â”œâ”€â”€ UserService
â”‚   â”œâ”€â”€ FormService
â”‚   â””â”€â”€ AuditService
â””â”€â”€ Database
    â””â”€â”€ Prisma ORM
```

## Database Schema

```
users (1:N relationships)
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ email (unique)
â”œâ”€â”€ password_hash
â”œâ”€â”€ name
â”œâ”€â”€ role_id (FK)
â”œâ”€â”€ is_active
â””â”€â”€ timestamps
    
roles (1:N permissions)
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ name (unique)
â””â”€â”€ is_custom

permissions
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ name (unique)
â”œâ”€â”€ resource
â””â”€â”€ action

role_permissions (M:N junction)
â”œâ”€â”€ role_id (FK)
â””â”€â”€ permission_id (FK)

forms
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ title
â”œâ”€â”€ created_by (FK users)
â”œâ”€â”€ is_published
â””â”€â”€ timestamps

form_fields
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ form_id (FK)
â”œâ”€â”€ name
â”œâ”€â”€ type
â””â”€â”€ config (JSONB)

form_submissions
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ form_id (FK)
â”œâ”€â”€ data (JSONB)
â””â”€â”€ timestamps

audit_logs
â”œâ”€â”€ id (UUID PK)
â”œâ”€â”€ user_id (FK)
â”œâ”€â”€ action
â”œâ”€â”€ resource
â””â”€â”€ timestamps
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Email + Password
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Login Endpoint        â”‚
â”‚ POST /api/auth/login    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Validate Credentials  â”‚
â”‚   Compare with DB       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Valid â”€â†’ Generate JWT â”€â†’ Return Token
       â”‚
       â””â”€ Invalid â”€â†’ Return 401

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Subsequent Requests    â”‚
â”‚  Authorization: Bearer  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JWT Validation        â”‚
â”‚   Middleware            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Valid â”€â†’ Check Permissions (RBAC)
       â”‚
       â””â”€ Invalid â”€â†’ Return 401
```

## Request Lifecycle

```
1. Client Request
   â”œâ”€ Frontend sends request
   â””â”€ Includes JWT in header

2. Backend Processing
   â”œâ”€ Parse request
   â”œâ”€ Validate JWT (auth middleware)
   â”œâ”€ Check RBAC (rbac middleware)
   â”œâ”€ Validate input (Zod)
   â”œâ”€ Log action (audit middleware)
   â”œâ”€ Execute business logic
   â””â”€ Query database via Prisma

3. Response
   â”œâ”€ Format response (JSON)
   â”œâ”€ Cache if applicable
   â”œâ”€ Return HTTP response
   â””â”€ Frontend receives and renders

4. Error Handling
   â”œâ”€ Validation errors â†’ 400
   â”œâ”€ Auth errors â†’ 401
   â”œâ”€ Permission errors â†’ 403
   â”œâ”€ Not found â†’ 404
   â””â”€ Server errors â†’ 500
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Production Environment            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Load Balancer / Reverse Proxy   â”‚  â”‚
â”‚  â”‚  (NGINX / AWS ALB)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ SSL/TLS Termination            â”‚  â”‚
â”‚  â”‚  â””â”€ Request Routing                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â–²                            â”‚
â”‚              â”‚ HTTPS                      â”‚
â”‚              â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Kubernetes Cluster (K8s)           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Frontend Pod (Next.js)         â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Replicas: 3                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Backend Pod (Express)          â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Replicas: 3                 â”‚  â”‚
â”‚  â”‚  â””â”€ HPA (Auto-scaling)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Data Tier                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ PostgreSQL (AWS RDS)          â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Multi-AZ Replication       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Redis (ElastiCache)            â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Multi-AZ Replication       â”‚  â”‚
â”‚  â”‚  â””â”€ S3 (File Storage)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Monitoring & Logging              â”‚  â”‚
â”‚  â”‚  â”œâ”€ CloudWatch / DataDog           â”‚  â”‚
â”‚  â”‚  â”œâ”€ ELK Stack (Logging)            â”‚  â”‚
â”‚  â”‚  â””â”€ Sentry (Error Tracking)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Application Security           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ Input Validation (Zod)            â”‚
â”‚ â–¶ SQL Injection Prevention (Prisma) â”‚
â”‚ â–¶ XSS Prevention (Next.js)           â”‚
â”‚ â–¶ CSRF Protection                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Authentication & RBAC           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ JWT Tokens (15 min expiry)        â”‚
â”‚ â–¶ Refresh Tokens (7 day expiry)     â”‚
â”‚ â–¶ Bcrypt Hashing (10+ rounds)       â”‚
â”‚ â–¶ Role-Based Access Control         â”‚
â”‚ â–¶ Permission Matrix                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Transport Security             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ HTTPS/TLS 1.2+                    â”‚
â”‚ â–¶ HSTS Headers                      â”‚
â”‚ â–¶ Security Headers                  â”‚
â”‚ â–¶ CORS Validation                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Infrastructure Security          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ Secrets in Environment Variables  â”‚
â”‚ â–¶ Database Encryption at Rest       â”‚
â”‚ â–¶ Network Isolation (VPC)           â”‚
â”‚ â–¶ WAF Rules                         â”‚
â”‚ â–¶ Rate Limiting                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Example: Form Submission

```
1. User fills form on frontend
2. Form validation (client-side)
3. POST /api/forms/:id/submit
   â”œâ”€ Backend receives
   â”œâ”€ JWT validation
   â”œâ”€ Permission check
   â”œâ”€ Input validation (Zod)
   â”œâ”€ Store in DB
   â”œâ”€ Create audit log
   â”œâ”€ Cache update
   â””â”€ Return response
4. Frontend displays confirmation
5. User sees submission in dashboard
6. Admin can view in admin panel
7. Audit log records the action
```

---

**Complete architecture ready for production implementation.**
